<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>代購平台 - 管理後台</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../../css/admin.css" />
  </head>
  <body>
    <div class="admin-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>Runtiger<br /><small>Admin Panel</small></h2>
        </div>
        <nav class="sidebar-nav">
          <a href="#" class="nav-link active" data-target="stats-section">
            <i class="fas fa-chart-line"></i> 儀表板
          </a>
          <a href="#" class="nav-link" data-target="orders-section">
            <i class="fas fa-shopping-cart"></i> 訂單管理
          </a>
          <a href="#" class="nav-link" data-target="products-section">
            <i class="fas fa-box"></i> 商品管理
          </a>
          <a
            href="#"
            class="nav-link"
            data-target="categories-section"
            data-role="admin"
          >
            <i class="fas fa-tags"></i> 分類管理
          </a>
          <a
            href="#"
            class="nav-link"
            data-target="warehouses-section"
            data-role="admin"
          >
            <i class="fas fa-warehouse"></i> 倉庫管理
          </a>
          <a
            href="#"
            class="nav-link"
            data-target="users-section"
            data-role="admin"
          >
            <i class="fas fa-users"></i> 人員權限
          </a>
          <a
            href="#"
            class="nav-link"
            data-target="settings-section"
            data-role="admin"
          >
            <i class="fas fa-cog"></i> 系統設置
          </a>
        </nav>
        <div class="sidebar-footer">
          <div class="user-info" id="user-info">載入中...</div>
          <button id="logout-button" class="btn-logout">
            <i class="fas fa-sign-out-alt"></i> 登出
          </button>
          <a href="../../html/index.html" class="back-link">回前台</a>
        </div>
      </aside>

      <main class="main-content">
        <section id="stats-section" class="dashboard-section active">
          <div class="section-header">
            <h2><i class="fas fa-chart-line"></i> 營運概況</h2>
            <button id="refresh-stats" class="btn btn-light">
              <i class="fas fa-sync"></i> 刷新
            </button>
          </div>

          <div id="stats-cards-container" class="stats-grid">
            <p>載入數據中...</p>
          </div>
        </section>

        <section id="orders-section" class="dashboard-section">
          <div class="section-header">
            <h2><i class="fas fa-shopping-cart"></i> 訂單列表</h2>
          </div>

          <div class="toolbar">
            <div class="search-box">
              <input
                type="text"
                id="order-search-input"
                placeholder="搜尋訂單ID / 會員編號 / Email..."
              />
              <button id="order-search-btn" class="btn btn-primary">
                搜尋
              </button>
            </div>
            <div class="filter-box">
              <select id="order-status-filter">
                <option value="">所有狀態</option>
                <option value="Pending">待處理</option>
                <option value="Processing">採購中</option>
                <option value="Shipped_Internal">已發貨 (往集運倉)</option>
                <option value="Warehouse_Received">已入倉</option>
                <option value="Completed">已完成</option>
                <option value="Cancelled">已取消</option>
              </select>
              <select id="order-payment-status-filter">
                <option value="">所有付款狀態</option>
                <option value="UNPAID">待付款</option>
                <option value="PAID">已付款</option>
              </select>
              <button id="refresh-orders" class="btn btn-light">重置</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>類型</th>
                  <th>建立時間</th>
                  <th>會員 (ID)</th>
                  <th>總金額 (TWD)</th>
                  <th>預估利潤</th>
                  <th>狀態</th>
                  <th>付款</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="orders-tbody"></tbody>
            </table>
          </div>
        </section>

        <section id="products-section" class="dashboard-section">
          <div class="section-header">
            <h2><i class="fas fa-box"></i> 商品列表</h2>
            <button id="btn-add-product" class="btn btn-primary">
              <i class="fas fa-plus"></i> 新增商品
            </button>
          </div>
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>圖片</th>
                  <th>名稱</th>
                  <th>分類</th>
                  <th>售價 (TWD)</th>
                  <th>成本 (CNY)</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="products-tbody"></tbody>
            </table>
          </div>
        </section>

        <section
          id="categories-section"
          class="dashboard-section"
          data-role="admin"
        >
          <div class="section-header">
            <h2><i class="fas fa-tags"></i> 分類管理</h2>
            <button id="btn-add-category" class="btn btn-primary">
              <i class="fas fa-plus"></i> 新增分類
            </button>
          </div>
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>名稱</th>
                  <th>描述</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="categories-tbody"></tbody>
            </table>
          </div>
        </section>

        <section
          id="warehouses-section"
          class="dashboard-section"
          data-role="admin"
        >
          <div class="section-header">
            <h2><i class="fas fa-warehouse"></i> 倉庫管理</h2>
            <button id="btn-add-warehouse" class="btn btn-primary">
              <i class="fas fa-plus"></i> 新增倉庫
            </button>
          </div>
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>名稱</th>
                  <th>收件人/電話</th>
                  <th>地址</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="warehouses-tbody"></tbody>
            </table>
          </div>
        </section>

        <section id="users-section" class="dashboard-section" data-role="admin">
          <div class="section-header">
            <h2><i class="fas fa-users"></i> 人員管理</h2>
            <button id="btn-add-user" class="btn btn-primary">
              <i class="fas fa-plus"></i> 建立新用戶
            </button>
          </div>

          <div class="toolbar">
            <div class="search-box">
              <input
                type="text"
                id="user-search-input"
                placeholder="搜尋帳號..."
              />
            </div>
          </div>

          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>帳號</th>
                  <th>角色</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="users-tbody"></tbody>
            </table>
          </div>
        </section>

        <section
          id="settings-section"
          class="dashboard-section"
          data-role="admin"
        >
          <div class="section-header">
            <h2><i class="fas fa-cog"></i> 系統參數設置</h2>
          </div>

          <div class="settings-card">
            <h3><i class="fas fa-coins"></i> 費率設定</h3>
            <div class="form-group">
              <label>匯率 (CNY → TWD)</label>
              <input type="number" id="exchange-rate-input" step="0.01" />
              <small>例: 4.5 表示 1 人民幣 = 4.5 台幣</small>
            </div>
            <div class="form-group">
              <label>代購服務費率</label>
              <input type="number" id="service-fee-input" step="0.01" />
              <small>例: 0.05 表示 5%</small>
            </div>
          </div>

          <div class="settings-card">
            <h3><i class="fas fa-university"></i> 收款銀行資訊 (前台顯示)</h3>
            <div class="form-group">
              <label>銀行名稱與代碼</label>
              <input
                type="text"
                id="bank-name-input"
                placeholder="例: 玉山銀行 (808)"
              />
            </div>
            <div class="form-group">
              <label>銀行帳號</label>
              <input type="text" id="bank-account-input" />
            </div>
            <div class="form-group">
              <label>戶名</label>
              <input type="text" id="bank-account-name-input" />
            </div>
          </div>

          <div class="settings-actions">
            <button id="save-settings-btn" class="btn btn-success btn-large">
              儲存所有設定
            </button>
          </div>
        </section>
      </main>
    </div>

    <div id="order-modal" class="modal">
      <div class="modal-content large-modal">
        <span class="close-modal">&times;</span>
        <h3 id="order-modal-title">訂單詳情</h3>
        <div class="modal-body">
          <div id="order-modal-content"></div>
        </div>
        <div class="modal-footer">
          <button id="btn-save-order" class="btn btn-primary">儲存變更</button>
        </div>
      </div>
    </div>

    <div id="product-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 id="product-modal-title">新增/編輯商品</h3>
        <form id="product-form">
          <input type="hidden" id="product-id" />
          <div class="form-group">
            <label>商品名稱 *</label>
            <input type="text" id="product-name" required />
          </div>
          <div class="form-group">
            <label>分類 *</label>
            <select id="product-category" required></select>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>售價 (TWD) *</label>
              <input type="number" id="product-price" required />
            </div>
            <div class="form-group">
              <label>成本 (CNY) *</label>
              <input type="number" id="product-cost" step="0.01" required />
            </div>
          </div>
          <div class="form-group">
            <label>描述</label>
            <textarea id="product-description" rows="3"></textarea>
          </div>
          <div class="form-group bg-light p-10">
            <label>圖片連結 (URL)</label>
            <div id="product-images-container">
              <input
                type="text"
                class="product-img-input"
                placeholder="主圖 URL"
                required
              />
            </div>
            <button
              type="button"
              id="btn-add-img-field"
              class="btn btn-small btn-secondary mt-5"
            >
              + 增加圖片
            </button>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">儲存商品</button>
          </div>
        </form>
      </div>
    </div>

    <div id="category-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 id="category-modal-title">分類</h3>
        <form id="category-form">
          <input type="hidden" id="category-id" />
          <div class="form-group">
            <label>分類名稱</label>
            <input type="text" id="category-name" required />
          </div>
          <div class="form-group">
            <label>描述</label>
            <textarea id="category-description"></textarea>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>

    <div id="warehouse-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 id="warehouse-modal-title">倉庫</h3>
        <form id="warehouse-form">
          <input type="hidden" id="warehouse-id" />
          <div class="form-group">
            <label>倉庫名稱</label>
            <input type="text" id="warehouse-name" required />
          </div>
          <div class="form-group">
            <label>收件人 (用 (會員編號) 代表變數)</label>
            <input type="text" id="warehouse-receiver" required />
          </div>
          <div class="form-group">
            <label>電話</label>
            <input type="text" id="warehouse-phone" required />
          </div>
          <div class="form-group">
            <label>地址</label>
            <textarea id="warehouse-address" required></textarea>
          </div>
          <div class="form-group">
            <label>狀態</label>
            <select id="warehouse-is-active">
              <option value="true">啟用</option>
              <option value="false">停用</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>

    <div id="user-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 id="user-modal-title">建立新用戶</h3>
        <form id="create-user-form">
          <input type="hidden" id="user-id" />
          <div class="form-group">
            <label>帳號</label>
            <input type="text" id="user-username" required />
          </div>
          <div class="form-group">
            <label id="user-password-label">密碼</label>
            <input type="text" id="user-password" />
            <small id="user-password-hint" style="color: #666"></small>
          </div>
          <div class="form-group">
            <label>角色</label>
            <select id="user-role">
              <option value="operator">操作員</option>
              <option value="admin">管理員</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">儲存</button>
          </div>
        </form>
      </div>
    </div>

    <div id="image-preview-modal" class="modal" style="z-index: 2000">
      <div class="modal-content" style="width: auto; max-width: 90%">
        <span class="close-modal">&times;</span>
        <div style="text-align: center">
          <img
            id="preview-image"
            src=""
            style="max-width: 100%; max-height: 80vh"
          />
        </div>
      </div>
    </div>

    <script type="module" src="../js/admin.js"></script>
  </body>
</html>
